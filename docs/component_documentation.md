# Документация UI Компонентов

## Введение

Этот документ описывает основные UI компоненты приложения Mr.Comic, их назначение, свойства и методы. Цель документации — облегчить понимание архитектуры UI и способствовать эффективной разработке и поддержке.

## Общие принципы

*   **Модульность**: Каждый компонент должен быть самодостаточным и выполнять одну конкретную задачу.
*   **Переиспользуемость**: Компоненты должны быть спроектированы таким образом, чтобы их можно было легко использовать в различных частях приложения.
*   **Адаптивность**: Компоненты должны корректно отображаться и функционировать на различных устройствах и размерах экрана.
*   **Доступность**: Компоненты должны быть доступны для пользователей с ограниченными возможностями (например, поддержка TalkBack, Voice Access).

## Список Компонентов

### 1. `ThemeManager.js`

**Назначение**: Управление темами приложения (светлая, темная, Material You, пользовательские).

**Свойства**:
*   `currentTheme`: Текущая активная тема.
*   `themes`: Коллекция доступных тем.

**Методы**:
*   `initialize()`: Инициализирует менеджер тем, загружает сохраненные настройки и применяет начальную тему.
*   `registerTheme(id, themeObject)`: Регистрирует новую тему.
*   `setTheme(themeId)`: Устанавливает активную тему по её ID.
*   `getCurrentTheme()`: Возвращает текущую активную тему.
*   `getAllThemes()`: Возвращает список всех зарегистрированных тем.
*   `loadSettings()`: Загружает настройки темы из локального хранилища.
*   `saveSettings()`: Сохраняет настройки темы в локальное хранилище.
*   `handleSystemThemeChange()`: Обработчик изменения системной темы (для автоматического режима).

### 2. `SettingsPanel.js`

**Назначение**: Панель настроек, предоставляющая пользовательский интерфейс для изменения различных параметров приложения, включая темы, шрифты, поднастройки интерфейса, темы сообщества, резервное копирование и профили.

**Свойства**:
*   `container`: DOM-элемент, в котором рендерится панель.
*   `activeTab`: Текущая активная вкладка настроек.
*   `themeEditor`, `fontEditor` и т.д.: Экземпляры редакторов для соответствующих вкладок.
*   `interfaceSettings`: Объект, хранящий настройки интерфейса (скругления, анимации, плотность и т.д.).

**Методы**:
*   `constructor(options)`: Инициализирует панель настроек.
*   `init()`: Инициализирует панель, рендерит её и настраивает перетаскиваемые панели инструментов.
*   `render()`: Рендерит или перерендерит панель настроек и её вкладки.
*   `loadInterfaceSettings()`: Загружает настройки интерфейса из локального хранилища.
*   `saveInterfaceSettings()`: Сохраняет настройки интерфейса в локальное хранилище.
*   `renderInterfaceSettings(panel)`: Рендерит вкладку 


интерфейса.
*   `_setupDraggableToolbars()`: Настраивает функциональность перетаскивания для панелей инструментов.
*   `_disableDraggableToolbars()`: Отключает функциональность перетаскивания.
*   `renderCommunityThemes(panel)`: Рендерит вкладку тем сообщества.
*   `renderBackupManagerPanel(panel)`: Рендерит вкладку резервного копирования.
*   `renderProfiles(panel)`: Рендерит вкладку профилей.
*   `renderCustomization(panel)`: Рендерит вкладку кастомизации.
*   `renderThemeEditor(panel)`: Рендерит редактор тем.
*   `renderFontEditor(panel)`: Рендерит редактор шрифтов.
*   `renderStyleEditor(panel)`: Рендерит редактор стилей.
*   `renderCommunityThemesEditor(panel)`: Рендерит редактор тем сообщества.
*   `renderEinkSettings(panel)`: Рендерит настройки режима E-ink.

### 3. `OverlayRenderer.js`

**Назначение**: Отвечает за рендеринг текстовых оверлеев на изображениях комиксов, включая поддержку различных шрифтов, вертикального текста, стилизации и анимации.

**Свойства**:
*   `canvas`: HTMLCanvasElement для рисования оверлеев.
*   `context`: 2D-контекст рендеринга канваса.
*   `currentImage`: Текущее изображение, на котором рисуется оверлей.
*   `overlayText`: Текст, который должен быть отображен.
*   `textStyle`: Объект, содержащий стили текста (цвет, шрифт, размер, эффекты).

**Методы**:
*   `constructor(options)`: Инициализирует рендерер оверлеев.
*   `renderOverlay(image, text, style)`: Основной метод для рисования оверлея на изображении.
*   `drawText(text, x, y, style)`: Рисует текст с заданными стилями и координатами.
*   `applyTextEffects(context, text, x, y, style)`: Применяет эффекты текста (градиент, тень, обводка).
*   `animateTextAppearance(text, style)`: Анимирует появление текста.
*   `exportToPNG(quality, size)`: Экспортирует текущий канвас в PNG с заданными настройками.

### 4. `TabletAdapter.js`

**Назначение**: Адаптирует пользовательский интерфейс приложения для различных типов устройств, таких как планшеты и складные устройства, а также для различных ориентаций экрана.

**Свойства**:
*   `isTablet`: Флаг, указывающий, является ли текущее устройство планшетом.
*   `isFoldable`: Флаг, указывающий, является ли текущее устройство складным.
*   `currentOrientation`: Текущая ориентация экрана (portrait/landscape).
*   `config`: Конфигурация адаптера (точки останова, макеты, настройки элементов управления).

**Методы**:
*   `initialize()`: Инициализирует адаптер, определяет тип устройства и ориентацию, добавляет обработчики событий.
*   `detectDeviceType()`: Определяет, является ли устройство планшетом или складным.
*   `detectOrientation()`: Определяет текущую ориентацию экрана.
*   `addEventListeners()`: Добавляет обработчики событий изменения размера окна и ориентации.
*   `updateComponent(id, componentData)`: Обновляет зарегистрированный компонент в соответствии с текущим типом устройства и ориентацией.
*   `updateLayoutComponent(element)`: Обновляет компонент макета.
*   `updateNavigationComponent(element)`: Обновляет компонент навигации.
*   `updateContentComponent(element)`: Обновляет компонент содержимого.
*   `testDifferentScreens()`: Заглушка для тестирования на разных экранах.

### 5. `UIScalingIntegration.js`

**Назначение**: Интегрирует систему масштабирования с компонентами пользовательского интерфейса, позволяя динамически изменять размер элементов UI в зависимости от настроек пользователя, темы и типа устройства.

**Свойства**:
*   `scalingManagers`: Карта менеджеров масштабирования для различных компонентов.
*   `defaultScalingOptions`: Настройки масштабирования по умолчанию (минимальный, максимальный шаг).

**Методы**:
*   `initialize()`: Инициализирует интегратор масштабирования, регистрирует обработчики событий и создает глобальные CSS-переменные.
*   `createScalingManager(componentId, rootElement, options)`: Создает менеджер масштабирования для конкретного компонента.
*   `handleScaleChange(componentId, scale)`: Обработчик изменения масштаба компонента.
*   `updateScalingSettings(settings)`: Обновляет настройки масштабирования.
*   `adaptScalingToTheme(theme)`: Адаптирует масштабирование к текущей теме.
*   `adaptScalingToDisplay(displayInfo)`: Адаптирует масштабирование к текущему устройству вывода (например, E-Ink).
*   `enableAccessibilityFeatures()`: Симулирует включение функций TalkBack и Voice Access.
*   `checkWCAGContrast()`: Проверяет контрастность цветов UI в соответствии с WCAG guidelines.

### 6. `ProfileManagerPanel.js`

**Назначение**: UI-компонент для управления профилями настроек, позволяющий пользователям создавать, применять, экспортировать и импортировать различные наборы настроек.

**Свойства**:
*   `container`: DOM-элемент для рендера панели.
*   `profileManager`: Экземпляр `ProfileManager` для взаимодействия с логикой управления профилями.
*   `state`: Объект, содержащий текущее состояние UI (список профилей, текущий профиль, ошибки).

**Методы**:
*   `constructor(options)`: Инициализирует панель управления профилями.
*   `render()`: Рендерит или перерендерит UI панели.
*   `handleApply(name)`: Применяет выбранный профиль.
*   `handleExport(name)`: Экспортирует профиль в JSON файл.
*   `handleDelete(name)`: Удаляет профиль.
*   `handleCreate()`: Создает новый профиль.
*   `handleImport()`: Импортирует профиль из JSON файла.


