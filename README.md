Comic reader application with a focus on customization. Inspired by ComiCat, aiming for enhanced user interface personalization (themes, fonts, layout, effects).

Это приложение для чтения комиксов, разрабатываемое с акцентом на кастомизацию и удобство использования.

**Основные возможности (Android GUI):**
*   Сканирование указанной директории на устройстве для обнаружения комиксов.
*   Отображение списка найденных комиксов с обложками (для CBZ), названием, количеством страниц (для CBZ) и прогрессом чтения.
*   **Просмотр комиксов**: Клик на комикс в списке открывает его в отдельном окне (`ComicReaderActivity`) для постраничного просмотра.
    *   Отображается текущая страница комикса.
    *   Кнопки "Next" (Следующая) и "Previous" (Предыдущая) для навигации по страницам.
    *   Отображение информации о текущей странице и общем количестве страниц (например, "1 / 150").
*   Отслеживание и сохранение прогресса чтения (текущая страница, процент прочтения) для каждого комикса между сессиями.
*   Извлечение обложек и определение общего количества страниц для `.cbz` файлов. Для других форматов используются заглушки.

## Поддерживаемые форматы

На данный момент приложение имеет следующую поддержку форматов для Android GUI:

*   **CBZ (.cbz):**
    *   Обнаружение и отображение в библиотеке.
    *   Извлечение обложки (выбирается наиболее подходящее изображение из архива).
    *   Определение общего количества страниц (количество изображений в архиве).
    *   Постраничный просмотр в отдельном окне с навигацией.
    *   Сохранение прогресса чтения.
*   **CBR (.cbr):**
    *   Обнаружение и отображение в библиотеке.
    *   Извлечение обложки (первое изображение из архива).
    *   Определение общего количества страниц (количество изображений в архиве).
    *   Постраничный просмотр в отдельном окне (используется `com.github.junrar` для извлечения страниц).
    *   Сохранение прогресса чтения.
*   **PDF (.pdf):**
    *   Обнаружение и отображение в библиотеке.
    *   Постраничный просмотр в отдельном окне с использованием библиотеки `com.github.barteksc:android-pdf-viewer` (поддерживает навигацию жестами, масштабирование).
    *   Количество страниц определяется при загрузке документа.
    *   Заглушка вместо обложки (извлечение обложек из PDF пока не реализовано).
    *   Сохранение прогресса чтения (текущая страница).

## Запуск консольного приложения (Устаревшая версия)

Для сборки и запуска консольного приложения `MrComicApp` выполните следующие шаги:

1.  **Скомпилируйте исходные файлы:**
    Откройте терминал в корневой директории проекта и выполните команды:
    ```bash
    javac -d out app/src/com/example/comicreader/*.java
    ```
    Эта команда скомпилирует все `.java` файлы, находящиеся непосредственно в директории `app/src/com/example/comicreader/`.
    (Примечание: возможно, потребуется указать кодировку, если возникнут проблемы с символами, например `-encoding UTF-8`.)

2.  **Запустите приложение:**
    После успешной компиляции, запустите приложение командой:
    ```bash
    java -cp out com.example.comicreader.MrComicApp [путь_к_вашей_директории_с_комиксами]
    ```
    -   `[путь_к_вашей_директории_с_комиксами]` - это необязательный аргумент. Если он не указан, приложение будет сканировать текущую директорию.

    Пример:
    ```bash
    java -cp out com.example.comicreader.MrComicApp /home/user/comics
    ```
    Или для текущей директории:
    ```bash
    java -cp out com.example.comicreader.MrComicApp
    ```

    Пример вывода (консольная версия):
    ```
    Loaded 0 progress entries.
    Scanning for comics in directory: /home/user/comics
    Listing comics found:
    1. MyComic (Pages: 152, Cover: /tmp/comic_cover_12345.jpg, Read: 0, Progress: 0%)
    ...
    Enter comic number to open (1-X), or 'q' to quit: 1
    ```
Консольное приложение также имело интерактивный режим для изменения текущей страницы, но основной фокус разработки сейчас на Android GUI.

## Хранение прогресса

Приложение автоматически сохраняет ваш прогресс чтения. Данные хранятся в файле `.mrcomic_progress.txt` в вашей домашней директории (определяемой через `System.getProperty("user.home")`).
Каждая строка в файле представляет один комикс и имеет формат:
`URL-кодированный_путь_к_файлу;текущая_страница;прогресс_чтения`
Где `прогресс_чтения` - это значение от 0.0 (не начато) до 1.0 (завершено).
Например:
`/home/user/comics/MyComic.cbz;10;0.07` (для комикса в 150 страниц, где прочитано 10 страниц, прогресс будет ~0.066, округленный до 0.07 или отображенный как 7%)

## Компиляция и запуск тестов

Для компиляции основного приложения и всех тестов (находящихся в `app/src/com/example/comicreader/` и `app/tests/com/example/comicreader/` соответственно), выполните:
```bash
javac -d out -cp out app/src/com/example/comicreader/*.java app/tests/com/example/comicreader/*.java
```
(Примечание: если вы компилируете тесты отдельно или впервые, убедитесь, что `out` директория создана и основной код уже скомпилирован, либо компилируйте всё вместе, как показано выше).

Для запуска каждого тестового класса:
```bash
java -cp out com.example.comicreader.ComicUtilsTest
java -cp out com.example.comicreader.ProgressManagerTest
java -cp out com.example.comicreader.ComicTest
```
Каждый тест выведет информацию о своем прохождении в консоль. Убедитесь, что для `ProgressManagerTest` у вас нет важного файла `~/.mrcomic_progress.txt`, так как тест создает, изменяет и удаляет этот файл (хотя и пытается сделать резервную копию и восстановить её).

## Используемые сторонние библиотеки (Android)

*   **`com.github.barteksc:android-pdf-viewer`**: для отображения PDF-файлов. ([Ссылка на GitHub](https://github.com/barteksc/AndroidPdfViewer))
*   **`com.github.junrar:junrar`**: для чтения RAR-архивов (CBR-файлы). ([Ссылка на GitHub](https://github.com/junrar/junrar))
